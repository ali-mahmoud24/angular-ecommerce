import{Da as u,Ia as m,Na as o,d as n,j as s,m as l,p as a}from"./chunk-2AKTDUK2.js";var g=class i{constructor(e,t){this.http=e;this.router=t;let r=localStorage.getItem("user");r?this._user$.next(JSON.parse(r)):this.router.navigateByUrl("/auth/login")}_user$=new n(null);user$=this._user$.asObservable();get currentUser(){return this._user$.value}get isLoggedIn(){return!!this._user$.value}get isAdmin(){return this._user$.value?.role==="admin"}register(e){return this.http.post(`${o.apiUrl}/auth/signup`,e).pipe(s(t=>{if(t.token){let r={token:t.token,firstName:t.user?.firstName,lastName:t.user?.lastName,email:t.user?.email,role:t.user?.role||"user"};localStorage.setItem("user",JSON.stringify(r)),this._user$.next(r),this.redirectBasedOnRole()}}))}login(e){return this.http.post(`${o.apiUrl}/auth/login`,e).pipe(s(t=>{if(console.log(t),t.token){let r={token:t.token,firstName:t.data.firstName,lastName:t.data.lastName,email:t.data.email,role:t.data.role||"user"};localStorage.setItem("user",JSON.stringify(r)),this._user$.next(r),this.redirectBasedOnRole()}}))}redirectBasedOnRole(){let e=this.currentUser;if(!e){this.router.navigateByUrl("/auth/login");return}e.role==="admin"?this.router.navigateByUrl("/admin"):this.router.navigateByUrl("/home")}logout(){localStorage.removeItem("user"),this._user$.next(null),this.router.navigateByUrl("/auth/login")}static \u0275fac=function(t){return new(t||i)(a(u),a(m))};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};export{g as a};
