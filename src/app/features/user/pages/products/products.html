<section class="py-12 bg-gray-50">
    <h2 class="text-3xl font-bold text-gray-800 mb-10 text-center">
        Featured Products
    </h2>

    <!-- Loading -->
    <div *ngIf="loading" class="flex justify-center py-10">
        <div class="h-10 w-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
    </div>

    <!-- Product grid -->
    <div *ngIf="!loading" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 max-w-7xl mx-auto">
        <div *ngFor="let product of products"
            class="bg-white rounded-2xl shadow-lg overflow-hidden flex flex-col hover:shadow-2xl transition transform hover:-translate-y-1">
            <!-- Clickable Product Image -->
            <div class="relative cursor-pointer" [routerLink]="['/product', product.id]">
                <img [src]="product.imageCoverUrl" [alt]="product.title"
                    class="w-full h-64 object-cover bg-gray-100 transition-transform duration-300 hover:scale-105" />
                <span *ngIf="product.discount"
                    class="absolute top-3 left-3 bg-red-500 text-white text-xs font-semibold px-2 py-1 rounded-full">
                    {{ product.discount }}% OFF
                </span>
            </div>

            <!-- Product Info -->
            <div class="p-5 flex flex-col flex-grow">
                <h3 class="text-lg font-semibold text-gray-800 truncate mb-2" title="{{ product.title }}">
                    {{ product.title }}
                </h3>

                <p class="text-blue-600 font-bold text-xl mb-2">
                    {{ product.price }} EGP
                </p>

                <p class="text-sm text-gray-500 mb-4" *ngIf="product.category?.name">
                    {{ product.category.name }}
                </p>

                <!-- Color Selection -->
                <label class="text-sm font-medium text-gray-700 mb-1">Color:</label>
                <select [(ngModel)]="product.selectedColor"
                    class="mb-3 border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:outline-none"
                    [disabled]="product.loadingCart" (click)="$event.stopPropagation()"
                    (mousedown)="$event.stopPropagation()">
                    <option *ngFor="let c of product.colors" [value]="c">{{ c }}</option>
                </select>

                <!-- Quantity Input -->
                <label class="text-sm font-medium text-gray-700 mb-1">Quantity:</label>
                <input type="number" [(ngModel)]="product.quantity" min="1"
                    class="mb-4 border border-gray-300 rounded px-3 py-2 focus:ring-2 focus:ring-blue-400 focus:outline-none"
                    [disabled]="product.loadingCart" (click)="$event.stopPropagation()"
                    (mousedown)="$event.stopPropagation()" (input)="onQuantityChange(product)" />

                <!-- Add to Cart Button -->
                <button (click)="addToCart(product); $event.stopPropagation()" [disabled]="product.loadingCart"
                    class="mt-auto w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition flex justify-center items-center font-semibold active:scale-[0.98] cursor-pointer">
                    <span *ngIf="!product.loadingCart">Add to Cart</span>
                    <svg *ngIf="product.loadingCart" class="animate-spin h-5 w-5 text-white"
                        xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 00-8 8h4l-3 3 3 3H4z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</section>
