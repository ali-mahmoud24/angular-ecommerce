<h2 class="text-xl font-semibold mb-4">
  {{ data ? 'Edit Product' : 'Add Product' }}
</h2>

<form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
  <!-- Title -->
  <div>
    <label class="block text-gray-600 mb-1">Title *</label>
    <input
      formControlName="title"
      type="text"
      placeholder="Product title"
      class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
    />
  </div>

  <!-- Description -->
  <div>
    <label class="block text-gray-600 mb-1">Description *</label>
    <textarea
      formControlName="description"
      rows="3"
      placeholder="Product description"
      class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none resize-none"
    ></textarea>
  </div>

  <!-- Price & Quantity -->
  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block text-gray-600 mb-1">Price (EGP) *</label>
      <input
        type="number"
        formControlName="price"
        min="0.01"
        step="0.01"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
      />
    </div>
    <div>
      <label class="block text-gray-600 mb-1">Quantity *</label>
      <input
        type="number"
        formControlName="quantity"
        min="1"
        step="1"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none"
      />
    </div>
  </div>

  <!-- Category & Brand -->
  <div class="grid grid-cols-2 gap-4">
    <div>
      <label class="block text-gray-600 mb-1">Category *</label>
      <select
        formControlName="category"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none bg-white"
      >
        <option value="" disabled selected>Select category</option>
        @for (cat of categories; track cat.id) {
        <option [value]="cat.id">{{ cat.name }}</option>
        }
      </select>
    </div>

    <div>
      <label class="block text-gray-600 mb-1">Brand</label>
      <select
        formControlName="brand"
        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 outline-none bg-white"
      >
        <option value="">Select brand</option>
        @for (brand of brands; track brand.id) {
        <option [value]="brand.id">{{ brand.name }}</option>
        }
      </select>
    </div>
  </div>

  <!-- Colors -->
  <div>
    <label class="block text-gray-600 mb-2">Colors</label>
    <div class="flex flex-wrap gap-3">
      @for (color of colorOptions; track color) {
      <label class="flex items-center gap-2 cursor-pointer">
        <input
          type="checkbox"
          class="accent-blue-600 rounded border-gray-300 w-4 h-4"
          [checked]="colorsArray.value.includes(color)"
          (change)="toggleColor(color, $event)"
        />
        <span class="w-5 h-5 rounded border border-gray-300" [style.backgroundColor]="color"></span>
        <span class="text-sm text-gray-700 capitalize">{{ color }}</span>
      </label>
      }
    </div>
  </div>

  <!-- Image Cover (Required) -->
  <div>
    <label class="block text-gray-600 mb-1">Image Cover *</label>
    <input
      type="file"
      accept="image/*"
      (change)="onImageCoverSelected($event)"
      class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
      required
    />

    @if (imageCoverPreview) {
    <img [src]="imageCoverPreview" class="mt-3 w-24 h-24 object-cover rounded-lg border" />
    }
  </div>

  <!-- Additional Images (Optional) -->
  <div>
    <label class="block text-gray-600 mb-1">Additional Images</label>
    <input
      type="file"
      multiple
      accept="image/*"
      (change)="onImagesSelected($event)"
      class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
    />

    <!-- Preview -->
    <div class="mt-3 flex flex-wrap gap-3">
      @for (img of imagePreviews; let i = $index; track i) {
      <div class="relative group">
        <img
          [src]="img"
          alt="Preview"
          class="w-20 h-20 object-cover rounded-lg border border-gray-200"
        />
        <button
          type="button"
          (click)="removeImage(i)"
          class="absolute top-1 right-1 bg-black/50 text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition"
        >
          &times;
        </button>
      </div>
      }
    </div>
  </div>

  <!-- Actions -->
  <div class="flex justify-end space-x-3 pt-4 border-t">
    <button
      type="button"
      (click)="close.emit()"
      class="px-4 py-2 border rounded-lg hover:bg-gray-100 transition"
    >
      Cancel
    </button>

    <button
      type="submit"
      [disabled]="loading || form.invalid"
      class="relative px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition disabled:opacity-60"
    >
      {{ loading ? (data ? 'Updating...' : 'Creating...') : data ? 'Update' : 'Create' }}
    </button>
  </div>
</form>
