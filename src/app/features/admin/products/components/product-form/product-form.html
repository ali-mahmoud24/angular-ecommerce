<h2 class="text-xl font-semibold mb-4">@if (data) { Edit Product } @else { Add Product }</h2>

<form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
  <!-- Title -->
  <div>
    <label class="block text-gray-600 mb-1">Title *</label>
    <input
      formControlName="title"
      type="text"
      placeholder="Product title"
      class="w-full border rounded-lg px-3 py-2"
    />

    @if (form.get('title')?.touched && form.get('title')?.invalid) {
    <p class="text-red-500 text-sm mt-1">
      @if (form.get('title')?.errors?.['required']) { Title is required. } @if
      (form.get('title')?.errors?.['minlength']) { Minimum 3 characters. }
    </p>
    }
  </div>

  <!-- Description -->
  <div>
    <label class="block text-gray-600 mb-1">Description *</label>
    <textarea
      formControlName="description"
      rows="3"
      class="w-full border rounded-lg px-3 py-2 resize-none"
    ></textarea>

    @if (form.get('description')?.touched && form.get('description')?.invalid) {
    <p class="text-red-500 text-sm mt-1">
      @if (form.get('description')?.errors?.['required']) { Description is required. } @if
      (form.get('description')?.errors?.['minlength']) { Minimum 20 characters. }
    </p>
    }
  </div>

  <!-- Price & Quantity -->
  <div class="grid grid-cols-2 gap-4">
    <div>
      <label>Price (EGP) *</label>
      <input type="number" formControlName="price" class="w-full border rounded-lg px-3 py-2" />

      @if (form.get('price')?.touched && form.get('price')?.invalid) {
      <p class="text-red-500 text-sm mt-1">
        @if (form.get('price')?.errors?.['required']) { Price is required. } @if
        (form.get('price')?.errors?.['min']) { Must be greater than 0. }
      </p>
      }
    </div>

    <div>
      <label>Quantity *</label>
      <input type="number" formControlName="quantity" class="w-full border rounded-lg px-3 py-2" />

      @if (form.get('quantity')?.touched && form.get('quantity')?.invalid) {
      <p class="text-red-500 text-sm mt-1">
        @if (form.get('quantity')?.errors?.['required']) { Quantity is required. } @if
        (form.get('quantity')?.errors?.['min']) { Must be at least 1. }
      </p>
      }
    </div>
  </div>

  <!-- Category & Brand -->
  <div class="grid grid-cols-2 gap-4">
    <div>
      <label>Category *</label>
      <select formControlName="category" class="w-full border rounded-lg px-3 py-2">
        <option value="" disabled>Select category</option>
        @for (cat of categories; track cat.id) {
        <option [value]="cat.id">{{ cat.name }}</option>
        }
      </select>

      @if (form.get('category')?.touched && form.get('category')?.invalid) {
      <p class="text-red-500 text-sm mt-1">Category is required.</p>
      }
    </div>

    <div>
      <label>Brand</label>
      <select formControlName="brand" class="w-full border rounded-lg px-3 py-2">
        <option value="">Select brand</option>
        @for (brand of brands; track brand.id) {
        <option [value]="brand.id">{{ brand.name }}</option>
        }
      </select>
    </div>
  </div>

  <!-- Colors -->
  <div>
    <label>Colors</label>
    <div class="flex flex-wrap gap-3">
      @for (color of colorOptions; track color) {
      <label class="flex items-center gap-2 cursor-pointer">
        <input
          type="checkbox"
          [checked]="colorsArray.value.includes(color)"
          (change)="toggleColor(color, $event)"
        />
        <span class="w-5 h-5 rounded border" [style.backgroundColor]="color"></span>
        <span class="capitalize">{{ color }}</span>
      </label>
      }
    </div>
  </div>

  <!-- Image Cover -->
  <div>
    <label>Image Cover *</label>
    <input
      type="file"
      accept="image/*"
      (change)="onImageCoverSelected($event)"
      class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
    />

    @if (imageCoverPreview) {
    <img [src]="imageCoverPreview" class="mt-3 w-24 h-24 object-cover rounded-lg border" />
    } @if (form.get('imageCover')?.touched && form.get('imageCover')?.invalid && !data) {
    <p class="text-red-500 text-sm mt-1">Cover image is required.</p>
    }
  </div>

  <!-- Additional Images -->
  <div>
    <label>Additional Images</label>
    <input
      type="file"
      accept="image/*"
      multiple
      (change)="onImagesSelected($event)"
      class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"
    />

    <div class="mt-3 flex gap-3 flex-wrap">
      @for (img of imagePreviews; let i = $index; track i) {
      <div class="relative">
        <img [src]="img" class="w-20 h-20 object-cover rounded border" />
        <button
          type="button"
          (click)="removeImage(i)"
          class="absolute top-1 right-1 bg-black/50 text-white w-6 h-6 rounded-full"
        >
          &times;
        </button>
      </div>
      }
    </div>
  </div>

  <!-- Actions -->
  <div class="flex justify-end gap-3 pt-4 border-t">
    <button type="button" (click)="close.emit()" class="border rounded-lg px-4 py-2">Cancel</button>
    <button
      type="submit"
      class="bg-blue-600 text-white px-4 py-2 rounded-lg disabled:opacity-50"
      [disabled]="loading || form.invalid"
    >
      @if (loading) { @if (data) { Updating... } @else { Creating... } } @else { @if (data) { Update
      } @else { Create } }
    </button>
  </div>
</form>
